user not fatch. fir se fix kro or agr jrurt ho to backend foder ko read kro fir try kro. fatch krne ke liye logics complax nhi krna jrurt ho to logics re-write krna. alg alg logics nhi krna. likhe hui logics hi update krna  jo fatch krne ke liye already likhe h.





ab m chahta hu ki role wise rights decide ho. jse super admin ko user page ke sare buttons dikhai de, enterprise admin ko unable canlogin ,disable canlogin ka button na dikhai de, school admin ko add user ko chhod kar koi button dikhai na de or usr ko koi bhi button dikhai na de.yani 

super admin -[user : { add user, disable user, enable user, disable user, reset password}, setup : {}]
enterprise admin - [user : {add user, disable user, reset password}]
branch admin - [user : {add user}]
user - []

iske according pure code ko set kro. ple muje btao ki kse kroge. pura layout . uske baad proper code kro. fir mujhe btao ki kse karna h . or Setup page bhi design kro, taki m frontend se rights desid kar sku




मैं चाहता हूं कि role-based access control (RBAC) system को पूरी तरह से implement किया जाए जहाँ प्रत्येक role के अनुसार specific permissions और UI elements दिखाई दें। 

**Requirements:**

1. **Role Hierarchy & Permissions Setup:**
   - Super Admin: पूर्ण access - user page के सभी buttons (add user, disable user, enable user, reset password) + setup page access
   - Enterprise Admin: limited access - add user, disable user, reset password buttons only (unable/disable canlogin button hidden)
   - School/Branch Admin: minimal access - only add user button visible
   - User: no admin buttons visible

2. **Technical Implementation Steps:**
   - Frontend layout में conditional rendering implement करें जो user role के आधार पर buttons show/hide करे
   - Backend middleware create करें जो प्रत्येक request पर role validation perform करे
   - Database में roles और permissions की proper structure बनाएं
   - Authentication system integrate करें जो login के समय user role identify करे

3. **Setup Page Design Requirements:**
   - Role management interface जहाँ admin different roles के permissions configure कर सके
   - Permission assignment matrix जहाँ प्रत्येक role के लिए page-wise और button-wise permissions set की जा सके
   - Real-time preview feature जो दिखाए की selected role को कौन-कौन से buttons दिखाई देंगे

4. **Code Structure:**
   - Modular architecture with separate files for role definitions, permission checks, and UI components
   - Reusable permission helper functions
   - Centralized role configuration object

5. **Testing & Documentation:**
   - प्रत्येक role के साथ login करके verify करें की सही buttons दिख रहे हैं
   - Documentation में role hierarchy और permission matrix include करें
   - Step-by-step implementation guide बनाएं

**Deliverables:**
- Complete frontend code with role-based conditional rendering
- Backend API endpoints for role validation
- Setup page for dynamic permission management
- Comprehensive documentation explaining implementation approach







RBAC Implementation Master Prompt
Objective: "मेरी एप्लीकेशन में एक 'Flexible Role-Based Access Control (RBAC)' सिस्टम लागू करें जहाँ अनुमतियाँ (Permissions) डेटाबेस से डायनामिक रूप से नियंत्रित हों और फ्रंटएंड पर कंडीशनल रेंडरिंग (Conditional Rendering) का उपयोग किया जाए।"

Instructions for the AI/IDE:

1. Analyze Architecture:
   
   - पहले मेरे User मॉडल, Auth Middleware , और Frontend App Structure को पढ़ें।
   - पहचानें कि लॉगिन और रिफ्रेश टोकन का फ्लो कहाँ हैंडल हो रहा है।
2. Database & Backend Changes:
   
   - Role Model: एक Role मॉडल बनाएँ जिसमें roleId , name , और permissions (array of {resource: string, actions: string[]} ) हो।
   - User Model: User मॉडल को अपडेट करें ताकि वह Role मॉडल को रेफरेंस (populate) कर सके।
   - Seeding: एक सीलिंग स्क्रिप्ट बनाएँ जो डिफ़ॉल्ट रोल्स (Super Admin, Enterprise Admin, etc.) को उनकी परमिशन के साथ डेटाबेस में सेव करे।
   - RBAC Middleware: एक मिडलवेयर बनाएँ checkPermission(resource, action) जो req.user.role.permissions की जांच करे।
   - Silent Auth: /api/auth/refresh या /api/auth/me एंडपॉइंट को अपडेट करें ताकि वह 401 एरर के बजाय 200 OK भेजे जब यूजर लॉग इन न हो (कंसोल को साफ रखने के लिए)।
3. Frontend Implementation:
   
   - Permission Context: एक PermissionProvider बनाएँ जो पूरे ऐप को user , hasPermission , और loading स्टेट उपलब्ध कराए।
   - Conditional Rendering: जहां भी बटन या नेविगेशन लिंक हैं, वहां hasPermission('resource', 'action') का उपयोग करके उन्हें सुरक्षित करें।
   - Protected Routes: ProtectedLayout को अपडेट करें ताकि वह PermissionContext की loading और user स्टेट का उपयोग करे।
4. Setup Page (Dynamic Management):
   
   - एक 'Setup' पेज बनाएँ जहाँ Super Admin किसी भी रोल की परमिशन को एक मैट्रिक्स (Matrix) के रूप में देख और बदल सके।
   - इसमें एक 'Real-time Preview' सेक्शन जोड़ें जो दिखाए कि सिलेक्टेड रोल को कौन-कौन से बटन दिखाई देंगे।
5. Coding Standards:
   
   - कोड को मॉड्यूलर रखें।
   - हेल्पर फंक्शन्स का उपयोग करें।
   - एग्ज़िस्टिंग कोडिंग स्टाइल और लाइब्रेरीज़ (जैसे Axios interceptors) को फॉलो करें।








User Management (Module Root)
- |-- Select All Inventory Actions
- |   |-- Add user
- |   |--Edit User
- |   |--Delete User

Asset Management (Module Root)
- |-- Inventory (Submodule)
- |   |-- Select All Inventory Actions
- |   |   |-- Add Item
- |   |   |--Edit Item
- |   |   |--Delete Item
- |-- Accessories (Submodule)
- |   |-- ...

Upgrade Management (Module Root)
- |-- Select All Inventory Actions
- |   |-- Create Request
- |   |--Approve Request
- |   |--Reject Request





The system is currently operational and module permissions are functioning correctly. However, there is a critical issue where authenticated users cannot retrieve their reporting employees who belong to the same branch and are assigned to them. 

Please investigate and resolve the data access problem that prevents logged-in users from fetching their reporting staff members within the same branch. Additionally, provide a comprehensive analysis of the specific permission rights and access controls that need to be configured to enable logged-in users to successfully retrieve their reporting employees. Include implementation steps for both the technical fix and the permission configuration, along with testing procedures to verify that users can access their reporting hierarchy data after the resolution.


mere according ye trika glat h. isse htao or user row ke action me ek button add kro Reporting To, jise hum user ko reporting authority assign bhi kar skte h, change kar skte h, or hta bhi skte h. agr uss user ko koi bhi reporting authority assign nhi h to vo user, us user ke login me dikhta rhega jiske usi branch match krti h. 

add user form se can login ka field hta do.
Role ki field bhi hta do, bydefault new created user ka role User hi hoga. or user row me ek button assign kro Edit Role. (cred Opretion)

Reporting To or Edit Role ke buttons ke role & rights bhi bnao. or make sure, ye sab working condition me hone chahiye.









